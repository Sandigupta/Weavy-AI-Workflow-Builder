# Project Overview

Develop a pixel-perfect UI/UX clone of Weavy.ai workflow builder, focused exclusively on LLM (Large Language Model) workflows. The application must use React Flow for the visual workflow canvas, integrate with Google's Gemini API for LLM execution via Trigger.dev, and demonstrate engineering excellence with type-safe APIs, proper state management, authentication, and seamless user experience.

**Important:** Before starting, sign up for a free account at Weavy.ai and explore the interface to understand the exact UI/UX patterns, interactions, and design language you need to replicate.

---

## üß† A Note to Applicants

We're transforming the way people work with AI. Millions of creators and teams at the world's most ambitious companies already build with us ‚Äî but we have much more work to do.

We obsess over talent to an unusual degree and are building a company that's a haven for self-motivated individual contributors. This work demands our best.

**So bring your A-game.** This could be the beginning of a highly rewarding journey. We can't wait to see what you build.

---

## üìã Functional Requirements

### ‚úÖ Core Workflow Interface (UI/UX)

| Requirement        | Description |
|-------------------|-------------|
| Pixel-Perfect UI  | Match Weavy's UI exactly ‚Äî background, layout, spacing, fonts, node designs, animations, and scrolling behavior |
| Left Sidebar      | Collapsible sidebar with search and quick access section for node types |
| Right Sidebar     | Workflow History Panel ‚Äî Shows list of all workflow runs with timestamps |


| Requirement          | Description |
|----------------------|-------------|
| Workflow Canvas      | Main area using React Flow with dot grid background, smooth panning/zooming, and MiniMap |
| Responsive Design    | Full responsiveness with proper overflow handling |

---

## üîß Node Types (Sidebar Buttons)

The left sidebar must contain exactly **6 buttons** under **Quick Access**:

### 1. Text Node
- Simple text input with textarea  
- Output handle for text data  

### 2. Upload Image Node
- File upload via Transloadit  
- Accepts: jpg, jpeg, png, webp, gif  
- Image preview after upload  
- Output handle for image URL  

### 3. Upload Video Node
- File upload via Transloadit  
- Accepts: mp4, mov, webm, m4v  
- Video player preview after upload  
- Output handle for video URL  

### 4. Run Any LLM Node
- Model selector dropdown  
- Accepts system prompt, user message, and images (supports multiple) as inputs  
- Executes via Trigger.dev task  

### 5. Crop Image Node
- Accepts image input  
- Configurable crop parameters (x%, y%, width%, height%)  
- Executes via FFmpeg on Trigger.dev  

### 6. Extract Frame from Video Node
- Accepts video URL input  
- Configurable timestamp parameter (seconds or percentage)


- Extracts a single frame as image  
- Executes via FFmpeg on Trigger.dev  

---

## üîê Authentication (Clerk)

| Requirement         | Description |
|---------------------|-------------|
| Auth Provider       | Clerk for all authentication |
| Sign In/Sign Up     | Clerk-hosted UI or embedded components |
| Protected Routes    | All workflow routes require authentication |
| User Association   | Workflows and history must be scoped to authenticated user |

---

## ü§ñ LLM Integration (Google Gemini API via Trigger.dev)

| Requirement        | Description |
|--------------------|-------------|
| API Provider       | Google Generative AI (Gemini) ‚Äî Free tier available via Google AI Studio |
| Execution          | **ALL LLM calls MUST run as Trigger.dev tasks** |
| Supported Models   | https://ai.google.dev/gemini-api/docs/models |
| Vision Support     | Accept images for multimodal prompts |
| System Prompts     | Support optional system instructions per request |
| Input Chaining     | Aggregate text/image inputs from connected nodes into the prompt |
| Error Handling     | Graceful error display with user-friendly messages |
| Loading States     | Visual feedback during API calls (spinner, disabled button) |


| Requirement            | Description |
|------------------------|-------------|
| Running Node Effect    | Nodes currently executing must have a pulsating glow effect to indicate active processing |

---

## LLM Node Specification

### Input Handles (3):
1. `system_prompt` ‚Äî Accepts connection from Text Node (optional)  
2. `user_message` ‚Äî Accepts connection from Text Node (required)  
3. `images` ‚Äî Accepts connections from Image Node(s) (optional, supports multiple)

### Output Handle (1):
- `output` ‚Äî Text response from LLM

### Result Display:
- **Results must be displayed directly on the LLM node itself** ‚Äî do NOT create a separate output node to show results. The LLM node should expand or show the response inline after execution.

---

## üñºÔ∏è Crop Image Node Specification (FFmpeg on Trigger.dev)

| Requirement | Description |
|-------------|-------------|
| Provider    | Internal (FFmpeg via Trigger.dev task) |
| Output      | Cropped image URL (uploaded via Transloadit) |

### Input Handles (5):
- `image_url` ‚Äî Required, accepts image types (jpg, jpeg, png, webp, gif)  
- `x_percent` ‚Äî Optional, accepts text/number (0‚Äì100), default: 0  
- `y_percent` ‚Äî Optional, accepts text/number (0‚Äì100), default: 0  
- `width_percent` ‚Äî Optional, accepts text/number (0‚Äì100), default: 100  
- `height_percent` ‚Äî Optional, accepts text/number (0‚Äì100), default: 100


### Output Handle (1):
- `output` ‚Äî Cropped image URL

---

## üéûÔ∏è Extract Frame from Video Node Specification (FFmpeg on Trigger.dev)

| Requirement     | Description |
|-----------------|-------------|
| Provider        | Internal (FFmpeg via Trigger.dev task) |
| Input Handles   | `video_url` and `timestamp` |
| Output          | Extracted frame image (uploaded via Transloadit) |

### Input Handles (2):
- `video_url` ‚Äî Required, accepts video types (mp4, mov, webm, m4v)  
- `timestamp` ‚Äî Optional, accepts text/number (seconds or "50%" for percentage), default: 0

### Output Handle (1):
- `output` ‚Äî Extracted frame image URL (jpg/png)

---

## üïí Workflow History (Right Sidebar)

| Requirement      | Description |
|------------------|-------------|
| History Panel    | Right sidebar showing list of all workflow runs |
| Execution Scope  | History tracks all execution types: full workflow runs, single node runs, and selected node group runs |
| Run Entry        | Each entry shows: timestamp, status (success/failed/partial), duration, and scope (full/partial/single) |


### Output Handle (1):
- `output` ‚Äî Cropped image URL

---

## üéûÔ∏è Extract Frame from Video Node Specification (FFmpeg on Trigger.dev)

| Requirement     | Description |
|-----------------|-------------|
| Provider        | Internal (FFmpeg via Trigger.dev task) |
| Input Handles   | `video_url` and `timestamp` |
| Output          | Extracted frame image (uploaded via Transloadit) |

### Input Handles (2):
- `video_url` ‚Äî Required, accepts video types (mp4, mov, webm, m4v)  
- `timestamp` ‚Äî Optional, accepts text/number (seconds or "50%" for percentage), default: 0

### Output Handle (1):
- `output` ‚Äî Extracted frame image URL (jpg/png)

---

## üïí Workflow History (Right Sidebar)

| Requirement      | Description |
|------------------|-------------|
| History Panel    | Right sidebar showing list of all workflow runs |
| Execution Scope  | History tracks all execution types: full workflow runs, single node runs, and selected node group runs |
| Run Entry        | Each entry shows: timestamp, status (success/failed/partial), duration, and scope (full/partial/single) |


| Requirement        | Description |
|--------------------|-------------|
| Click to Expand    | Clicking a run shows node-level execution details |
| Node-Level History | For each node: status, inputs used, outputs generated, execution time |
| Partial Runs       | Show which nodes ran successfully even if workflow failed |
| Visual Indicators  | Color-coded status badges (green=success, red=failed, yellow=running) |
| Persistence        | All history must persist to PostgreSQL database |

---

## Node-Level History View:

When clicking on a workflow run, display:

**Run #123 - Jan 14, 2026 3:45 PM (Full Workflow)**

```
‚îú‚îÄ‚îÄ Text Node (node-1) ‚úÖ 0.1s
‚îÇ   ‚îî‚îÄ‚îÄ Output: "Generate a product description..."
‚îú‚îÄ‚îÄ Image Node (node-2) ‚úÖ 2.3s
‚îÇ   ‚îî‚îÄ‚îÄ Output: https://cdn.transloadit.com/...
‚îú‚îÄ‚îÄ Crop Image (node-3) ‚úÖ 1.8s
‚îÇ   ‚îî‚îÄ‚îÄ Output: https://cdn.transloadit.com/...
‚îú‚îÄ‚îÄ LLM Node (node-4) ‚úÖ 4.2s
‚îÇ   ‚îî‚îÄ‚îÄ Output: "Introducing our premium..."
‚îî‚îÄ‚îÄ Extract Frame (node-5) ‚ùå Failed
    ‚îî‚îÄ‚îÄ Error: "Invalid timestamp parameter"
```

**Selected Nodes Run Example:**


**Run #124 - Jan 14, 2026 4:12 PM (2 nodes selected)**

```
‚îú‚îÄ‚îÄ Crop Image (node-3) ‚úÖ 1.5s
‚îÇ   ‚îî‚îÄ‚îÄ Output: https://cdn.transloadit.com/...
‚îî‚îÄ‚îÄ LLM Node (node-4) ‚úÖ 3.1s
    ‚îî‚îÄ‚îÄ Output: "Updated product copy..."
```

### Single Node Run Example:

**Run #125 - Jan 14, 2026 4:30 PM (Single Node)**

```
‚îî‚îÄ‚îÄ LLM Node (node-4) ‚úÖ 2.8s
    ‚îî‚îÄ‚îÄ Output: "Quick test response..."
```

---

## üîó Workflow Features

| Feature | Description |
|--------|-------------|
| Drag & Drop Nodes | Add nodes from sidebar to canvas via click or drag |
| Node Connections | Connect output handles to input handles with animated edges |
| Configurable Inputs | All node parameters must be configurable via input handles OR manual entry ‚Äî e.g., Crop Image's x/y/width/height can be connected from other nodes or entered directly |
| Connected Input State | When an input handle has a connection, disable the corresponding manual input field in the UI (greyed out) ‚Äî the value comes from the connected node |
| Type-Safe Connections | Enforce type-safe connections: image nodes cannot connect to prompt/system prompt inputs, text outputs cannot connect to file inputs ‚Äî invalid connections must be visually disallowed |

| Feature | Description |
|--------|-------------|
| DAG Validation | Workflows must be DAG (Directed Acyclic Graph); circular loops/cycles should not be allowed |
| Node Deletion | Delete nodes via menu button or keyboard (Delete/Backspace) |
| Canvas Navigation | Pan (drag background), zoom (scroll wheel), fit view |
| MiniMap | Bottom-right corner navigation minimap |
| Undo/Redo | Implement undo/redo for node operations |
| Selective Execution | Allow users to run a single node, select multiple nodes, or run the entire workflow ‚Äî each creates a history entry |
| Parallel Execution | Independent branches in the workflow DAG must execute concurrently ‚Äî nodes only wait for their direct dependencies, not unrelated nodes |
| Workflow Persistence | Save/load workflows to PostgreSQL database |

---

## üß™ Technical Specifications

### üì¶ Project Stack (Required)

| Technology | Purpose |
|-----------|---------|
| Next.js+ | React framework with App Router |
| TypeScript | Type safety throughout the codebase |
| PostgreSQL | Database (use Supabase, Neon, or similar) |
| Prisma | ORM for database access |
| Clerk | Authentication |



| Technology | Purpose |
|-----------|---------|
| React Flow | Visual workflow/node graph library |
| Trigger.dev | **ALL node execution MUST use Trigger.dev** |
| Transloadit | File uploads and media processing |
| FFmpeg | Image/video processing (via Trigger.dev) |
| Tailwind CSS | Styling (match Weavy's theme exactly) |
| Zustand | State management |
| Zod | Schema validation |
| Google Generative AI SDK | `@google/generative-ai` package |
| Lucide React | Icon library |

---

## ‚ö° Trigger.dev Requirements

**Every node execution MUST be a Trigger.dev task.**  
This is non-negotiable.

| Node Type | Trigger.dev Task |
|----------|------------------|
| LLM Node | Task that calls Gemini API |
| Crop Image | Task that runs FFmpeg crop operation |
| Extract Frame | Task that runs FFmpeg frame extraction |

### Parallel Task Execution

- Independent nodes (no dependencies between them) must be triggered concurrently  
- Tasks should only await completion of their direct upstream dependencies  
- Example: If Node A and Node B have no connection, trigger both tasks simultaneously rather than sequentially


## üéØ Required Sample Workflow

Your submission must include a **pre-built sample workflow** that demonstrates all node types, parallel execution, and input chaining. This workflow will be used to verify all features are working correctly.

### Sample Workflow: Product Marketing Kit Generator

This workflow demonstrates all **6 node types** working together with **parallel execution** and a **convergence point**. Two independent branches run simultaneously, then merge at a final node that waits for both to complete.

---

### Branch A: Image Processing + Product Description

**Nodes involved:** Upload Image, Crop Image, Text (√ó2), LLM Node #1

**Flow:**

1. **Upload Image Node** ‚Äî User uploads a product photo (jpg/png/webp)
2. **Crop Image Node** ‚Äî Receives the uploaded image and crops it to focus on the product  
   (e.g., center crop at 80% width/height)
3. **Text Node #1 (System Prompt)** ‚Äî Contains:  
   _"You are a professional marketing copywriter. Generate a compelling one-paragraph product description."_
4. **Text Node #2 (Product Details)** ‚Äî Contains:  
   _"Product: Wireless Bluetooth Headphones. Features: Noise cancellation, 30-hour battery, foldable design."_
5. **LLM Node #1** ‚Äî Receives:
   - `system_prompt` ‚Üê Text Node #1
   - `user_message` ‚Üê Text Node #2
   - `images` ‚Üê Crop Image Node (cropped product photo)
   - **Outputs:** AI-generated product description

---

### Branch B: Video Frame Extraction

**Nodes involved:** Upload Video, Extract Frame from Video

**Flow:**

1. **Upload Video Node** ‚Äî User uploads a product demo video (mp4/mov/webm)
2. **Extract Frame from Video Node** ‚Äî Receives:
   - `video_url` ‚Üê Upload Video Node
   - `timestamp` ‚Üê `"50%"` (extracts frame from middle of video)


- **Outputs:** Extracted frame image URL

---

## üîÄ Convergence Point: Final Marketing Summary

**Node:** LLM Node #2 (waits for **BOTH** branches to complete)

### Inputs:
- `system_prompt` ‚Üê Text Node #3:  
  _"You are a social media manager. Create a tweet-length marketing post based on the product image and video frame."_
- `user_message` ‚Üê LLM Node #1 output (product description from Branch A)
- `images` ‚Üê Cropped product image (Branch A) + Extracted video frame (Branch B)

**What it does:**  
Takes the product description from Branch A **and** visual content from both branches (cropped product photo + video frame). The LLM can now ‚Äúsee‚Äù and analyze both images to create a more informed, visually-aware marketing post.

**Outputs:** Final marketing tweet/post displayed inline on the node

---

## ‚è±Ô∏è Execution Timeline

| Phase | Branch A | Branch B | Convergence |
|------|----------|----------|-------------|
| Phase 1 | Upload Image + Text Nodes | Upload Video | ‚Äî |
| Phase 2 | Crop Image Node | Extract Frame Node | ‚Äî |
| Phase 3 | LLM Node #1 (waits for crop + texts) | *(complete)* | ‚Äî |
| Phase 4 | *(complete)* | *(complete)* | **LLM Node #2 (waits for both)** |

### Key Demonstration:
- Branch A and Branch B run **in parallel** during Phases 1‚Äì3  
- The **Convergence Node (LLM #2)** only executes after **both branches complete**  
- If Branch B finishes first, it waits. If Branch A finishes first, it waits.  
- The convergence node triggers **only when all upstream dependencies are satisfied**

## üß™ Deliverables Checklist

### Required

- [ ] Pixel-perfect Weavy clone UI (exact spacing/colors)
- [ ] Clerk authentication with protected routes
- [ ] Left sidebar with **6 buttons** (Text, Upload Image, Upload Video, LLM, Crop Image, Extract Frame)
- [ ] Right sidebar with workflow history panel
- [ ] Node-level execution history when clicking a run
- [ ] React Flow canvas with dot grid background
- [ ] Functional **Text Node** with textarea and output handle
- [ ] Functional **Upload Image Node** with Transloadit upload and image preview
- [ ] Functional **Upload Video Node** with Transloadit upload and video player preview
- [ ] Functional **LLM Node** with model selector, prompts, and run capability
- [ ] Functional **Crop Image Node** (FFmpeg via Trigger.dev)
- [ ] Functional **Extract Frame from Video Node** (FFmpeg via Trigger.dev)
- [ ] **All node executions via Trigger.dev tasks**
- [ ] Pulsating glow effect on nodes during execution
- [ ] Pre-built sample workflow (demonstrates all features)
- [ ] Node connections with animated purple edges
- [ ] API routes with Zod validation
- [ ] Google Gemini integration with vision support
- [ ] TypeScript throughout with strict mode
- [ ] PostgreSQL database with Prisma ORM
- [ ] Workflow save/load to database
- [ ] Workflow history persistence to database
- [ ] Workflow export/import as JSON
- [ ] Deployed on Vercel with environment variables

---

## üîë Getting API Keys

1. **Google AI:** Go to **Google AI Studio**
2. **Clerk:** Sign up at **clerk.com**
3. **Trigger.dev:** Sign up at **trigger.dev**
4. **Transloadit:** Sign up at **transloadit.com**
5. **PostgreSQL:** Use **Supabase** or **Neon**


## üöÄ Submission Requirements

1. **GitHub Repository** ‚Äî Public or private with access granted
2. **Vercel Deployment** ‚Äî Live demo URL
3. **Demo Video** ‚Äî 3‚Äì5 minute walkthrough covering:
   - User authentication flow
   - Creating a workflow with all **6 node types**
   - Uploading files (image, video) via Transloadit
   - Running the full workflow and viewing real-time status (pulsating glow on running nodes)
   - Running a single node and running selected nodes
   - Viewing workflow history in right sidebar (showing all run types)
   - Clicking a run to see node-level execution details
   - Export/import workflow as JSON

---

## üìö Resources

- **Weavy.ai** ‚Äî Reference application (create free account)
- **React Flow Documentation**
- **Trigger.dev Documentation**
- **Clerk Documentation**
- **Transloadit Documentation**
- **Prisma Documentation**
- **Google AI Studio** ‚Äî Get API key
- **Gemini API Documentation**
- **Zustand Documentation**
- **Zod Documentation**
- **FFmpeg Documentation**
